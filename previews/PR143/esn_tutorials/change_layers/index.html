<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Using Different Layers · ReservoirComputing.jl</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-90474609-3"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-90474609-3', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://docs.sciml.ai/ReservoirComputing/stable/esn_tutorials/change_layers/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="ReservoirComputing.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ReservoirComputing.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">ReservoirComputing.jl</a></li><li><span class="tocitem">General Settings</span><ul><li><a class="tocitem" href="../../general/different_training/">Changing Training Algorithms</a></li><li><a class="tocitem" href="../../general/states_variation/">Altering States</a></li><li><a class="tocitem" href="../../general/predictive_generative/">Generative vs Predictive</a></li></ul></li><li><span class="tocitem">Echo State Network Tutorials</span><ul><li><a class="tocitem" href="../lorenz_basic/">Lorenz System Forecasting</a></li><li><a class="tocitem" href="../mackeyglass_basic/">Mackey-Glass Forecasting on GPU</a></li><li class="is-active"><a class="tocitem" href>Using Different Layers</a><ul class="internal"><li><a class="tocitem" href="#Example-of-minimally-complex-ESN"><span>Example of minimally complex ESN</span></a></li><li><a class="tocitem" href="#Bibliography"><span>Bibliography</span></a></li></ul></li><li><a class="tocitem" href="../different_drivers/">Using Different Reservoir Drivers</a></li><li><a class="tocitem" href="../deep_esn/">Deep Echo State Networks</a></li><li><a class="tocitem" href="../hybrid/">Hybrid Echo State Networks</a></li></ul></li><li><a class="tocitem" href="../../reca_tutorials/reca/">Reservoir Computing with Cellular Automata</a></li><li><span class="tocitem">API Documentation</span><ul><li><a class="tocitem" href="../../api/training/">Training Algorithms</a></li><li><a class="tocitem" href="../../api/states/">States Modifications</a></li><li><a class="tocitem" href="../../api/predict/">Prediction Types</a></li><li><a class="tocitem" href="../../api/esn/">Echo State Networks</a></li><li><a class="tocitem" href="../../api/esn_layers/">ESN Layers</a></li><li><a class="tocitem" href="../../api/esn_drivers/">ESN Drivers</a></li><li><a class="tocitem" href="../../api/reca/">ReCA</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Echo State Network Tutorials</a></li><li class="is-active"><a href>Using Different Layers</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Using Different Layers</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SciML/ReservoirComputing.jl/blob/master/docs/src/esn_tutorials/change_layers.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Using-Different-Layers"><a class="docs-heading-anchor" href="#Using-Different-Layers">Using Different Layers</a><a id="Using-Different-Layers-1"></a><a class="docs-heading-anchor-permalink" href="#Using-Different-Layers" title="Permalink"></a></h1><p>A great deal of efforts in the ESNs field are devoted to finding an ideal construction for the reservoir matrices. With a simple interface using ReservoirComputing.jl is possible to leverage the currently implemented matrix constructions methods for both the reservoir and the input layer. In this page it is showcased how it is possible to change both of these layers.</p><p>The <code>input_init</code> keyword argument provided with the <code>ESN</code> constructor allows for changing the input layer. The layers provided in ReservoirComputing.jl are the following:</p><ul><li><code>WeightedLayer(scaling)</code></li><li><code>DenseLayer(scaling)</code></li><li><code>SparseLayer(scaling, sparsity)</code></li><li><code>MinimumLayer(weight, sampling)</code></li><li><code>InformedLayer(model_in_size; scaling=0.1, gamma=0.5)</code></li></ul><p>In addition the user can define a custom layer following this workflow:</p><pre><code class="language-julia hljs">#creation of the new struct for the layer
struct MyNewLayer &lt;: AbstractLayer
    #the layer params go here
end

#dispatch over the function to actually build the layer matrix
function create_layer(input_layer::MyNewLayer, res_size, in_size)
    #the new algorithm to build the input layer goes here
end</code></pre><p>Similarly the <code>reservoir_init</code> keyword argument provides the possibility to change the construction for the reservoir matrix. The available reservoir are:</p><ul><li><code>RandSparseReservoir(res_size, radius, sparsity)</code></li><li><code>PseudoSVDReservoir(res_size, max_value, sparsity, sorted, reverse_sort)</code></li><li><code>DelayLineReservoir(res_size, weight)</code></li><li><code>DelayLineBackwardReservoir(res_size, weight, fb_weight)</code></li><li><code>SimpleCycleReservoir(res_size, weight)</code></li><li><code>CycleJumpsReservoir(res_size, cycle_weight, jump_weight, jump_size)</code></li></ul><p>And, like before, it is possible to build a custom reservoir by following this workflow:</p><pre><code class="language-julia hljs">#creation of the new struct for the reservoir
struct MyNewReservoir &lt;: AbstractReservoir
    #the reservoir params go here
end

#dispatch over the function to build the reservoir matrix
function create_reservoir(reservoir::AbstractReservoir, res_size)
    #the new algorithm to build the reservoir matrix goes here
end</code></pre><h2 id="Example-of-minimally-complex-ESN"><a class="docs-heading-anchor" href="#Example-of-minimally-complex-ESN">Example of minimally complex ESN</a><a id="Example-of-minimally-complex-ESN-1"></a><a class="docs-heading-anchor-permalink" href="#Example-of-minimally-complex-ESN" title="Permalink"></a></h2><p>Using <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup> and <sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup> as references this section will provide an example on how to change both the input layer and the reservoir for ESNs. The full script for this example can be found <a href="https://github.com/MartinuzziFrancesco/reservoir-computing-examples/blob/main/change_layers/layers.jl">here</a>. This example was run on Julia v1.7.2.</p><p>The task for this example will be the one step ahead prediction of the Henon map. To obtain the data one can leverage the package <a href="https://juliadynamics.github.io/DynamicalSystems.jl/dev/">DynamicalSystems.jl</a>. The data is scaled to be between -1 and 1.</p><pre><code class="language-julia hljs">using DynamicalSystems
train_len = 3000
predict_len = 2000

ds = Systems.henon()
traj = trajectory(ds, 7000)
data = Matrix(traj)&#39;
data = (data .-0.5) .* 2
shift = 200

training_input = data[:, shift:shift+train_len-1]
training_target = data[:, shift+1:shift+train_len]
testing_input = data[:,shift+train_len:shift+train_len+predict_len-1]
testing_target = data[:,shift+train_len+1:shift+train_len+predict_len]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2×2000 Matrix{Float64}:
  0.0479479  -0.00671812   0.623758  …  -2.16788    0.70156  -1.37708
 -1.23798    -0.685616    -0.702015     -0.343682  -1.35036  -0.489532</code></pre><p>Now it is possible to define the input layers and reservoirs we want to compare and run the comparison in a simple for loop. The accuracy will be tested using the mean squared deviation <code>msd</code> from <a href="https://juliastats.org/StatsBase.jl/stable/">StatsBase</a>.</p><pre><code class="language- hljs">using ReservoirComputing, StatsBase

res_size = 300
input_layer = [MinimumLayer(0.85, IrrationalSample()), MinimumLayer(0.95, IrrationalSample())]
reservoirs = [SimpleCycleReservoir(res_size, 0.7), 
     CycleJumpsReservoir(res_size, cycle_weight=0.7, jump_weight=0.2, jump_size=5)]

for i=1:length(reservoirs)
    esn = ESN(training_input;
        input_layer = input_layer[i],
        reservoir = reservoirs[i])
    wout = train(esn, training_target, StandardRidge(0.001))
    output = esn(Predictive(testing_input), wout)
    println(msd(testing_target, output))
end</code></pre><p>As it is possible to see, changing layers in ESN models is straightforward. Be sure to check the API documentation for a full list of reservoir and layers.</p><h2 id="Bibliography"><a class="docs-heading-anchor" href="#Bibliography">Bibliography</a><a id="Bibliography-1"></a><a class="docs-heading-anchor-permalink" href="#Bibliography" title="Permalink"></a></h2><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>Rodan, Ali, and Peter Tiňo. “Simple deterministically constructed cycle reservoirs with regular jumps.” Neural computation 24.7 (2012): 1822-1852.</li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a>Rodan, Ali, and Peter Tiňo. “Minimum complexity echo state network.” IEEE transactions on neural networks 22.1 (2010): 131-144.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../mackeyglass_basic/">« Mackey-Glass Forecasting on GPU</a><a class="docs-footer-nextpage" href="../different_drivers/">Using Different Reservoir Drivers »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Saturday 10 December 2022 18:39">Saturday 10 December 2022</span>. Using Julia version 1.8.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
