<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Deep Echo State Networks · ReservoirComputing.jl</title><meta name="title" content="Deep Echo State Networks · ReservoirComputing.jl"/><meta property="og:title" content="Deep Echo State Networks · ReservoirComputing.jl"/><meta property="twitter:title" content="Deep Echo State Networks · ReservoirComputing.jl"/><meta name="description" content="Documentation for ReservoirComputing.jl."/><meta property="og:description" content="Documentation for ReservoirComputing.jl."/><meta property="twitter:description" content="Documentation for ReservoirComputing.jl."/><meta property="og:url" content="https://docs.sciml.ai/ReservoirComputing/stable/esn_tutorials/deep_esn/"/><meta property="twitter:url" content="https://docs.sciml.ai/ReservoirComputing/stable/esn_tutorials/deep_esn/"/><link rel="canonical" href="https://docs.sciml.ai/ReservoirComputing/stable/esn_tutorials/deep_esn/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="ReservoirComputing.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ReservoirComputing.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">ReservoirComputing.jl</a></li><li><span class="tocitem">General Settings</span><ul><li><a class="tocitem" href="../../general/different_training/">Changing Training Algorithms</a></li><li><a class="tocitem" href="../../general/states_variation/">Altering States</a></li><li><a class="tocitem" href="../../general/predictive_generative/">Generative vs Predictive</a></li></ul></li><li><span class="tocitem">Echo State Network Tutorials</span><ul><li><a class="tocitem" href="../lorenz_basic/">Lorenz System Forecasting</a></li><li><a class="tocitem" href="../change_layers/">Using Different Layers</a></li><li><a class="tocitem" href="../different_drivers/">Using Different Reservoir Drivers</a></li><li class="is-active"><a class="tocitem" href>Deep Echo State Networks</a><ul class="internal"><li><a class="tocitem" href="#Lorenz-Example"><span>Lorenz Example</span></a></li><li><a class="tocitem" href="#Documentation"><span>Documentation</span></a></li></ul></li><li><a class="tocitem" href="../hybrid/">Hybrid Echo State Networks</a></li></ul></li><li><a class="tocitem" href="../../reca_tutorials/reca/">Reservoir Computing with Cellular Automata</a></li><li><span class="tocitem">API Documentation</span><ul><li><a class="tocitem" href="../../api/training/">Training Algorithms</a></li><li><a class="tocitem" href="../../api/states/">States Modifications</a></li><li><a class="tocitem" href="../../api/predict/">Prediction Types</a></li><li><a class="tocitem" href="../../api/esn/">Echo State Networks</a></li><li><a class="tocitem" href="../../api/esn_layers/">ESN Layers</a></li><li><a class="tocitem" href="../../api/esn_drivers/">ESN Drivers</a></li><li><a class="tocitem" href="../../api/reca/">ReCA</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Echo State Network Tutorials</a></li><li class="is-active"><a href>Deep Echo State Networks</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Deep Echo State Networks</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SciML/ReservoirComputing.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SciML/ReservoirComputing.jl/blob/master/docs/src/esn_tutorials/deep_esn.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Deep-Echo-State-Networks"><a class="docs-heading-anchor" href="#Deep-Echo-State-Networks">Deep Echo State Networks</a><a id="Deep-Echo-State-Networks-1"></a><a class="docs-heading-anchor-permalink" href="#Deep-Echo-State-Networks" title="Permalink"></a></h1><p>Deep Echo State Network architectures started to gain some traction recently. In this guide, we illustrate how it is possible to use ReservoirComputing.jl to build a deep ESN. </p><p>The network implemented in this library is taken from <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>. It works by stacking reservoirs on top of each other, feeding the output from one into the next. The states are obtained by merging all the inner states of the stacked reservoirs. For a more in-depth explanation, refer to the paper linked above. The full script for this example can be found <a href="https://github.com/MartinuzziFrancesco/reservoir-computing-examples/blob/main/deep-esn/deepesn.jl">here</a>. This example was run on Julia v1.7.2.</p><h2 id="Lorenz-Example"><a class="docs-heading-anchor" href="#Lorenz-Example">Lorenz Example</a><a id="Lorenz-Example-1"></a><a class="docs-heading-anchor-permalink" href="#Lorenz-Example" title="Permalink"></a></h2><p>For this example, we are going to reuse the Lorenz data used in the <a href="../lorenz_basic/#Lorenz-System-Forecasting">Lorenz System Forecasting</a> example.</p><pre><code class="language-julia hljs">using OrdinaryDiffEq

#define lorenz system
function lorenz!(du,u,p,t)
    du[1] = 10.0*(u[2]-u[1])
    du[2] = u[1]*(28.0-u[3]) - u[2]
    du[3] = u[1]*u[2] - (8/3)*u[3]
end

#solve and take data
prob = ODEProblem(lorenz!, [1.0,0.0,0.0], (0.0,200.0))
data = solve(prob, ABM54(), dt=0.02)

#determine shift length, training length and prediction length
shift = 300
train_len = 5000
predict_len = 1250

#split the data accordingly
input_data = data[:, shift:shift+train_len-1]
target_data = data[:, shift+1:shift+train_len]
test_data = data[:,shift+train_len+1:shift+train_len+predict_len]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3×1250 Matrix{Float64}:
  4.2235    3.83533   3.55846   3.38262  …   9.44212  10.0034  10.5085
  1.98782   2.18137   2.43519   2.7396      12.3382   12.6956  12.8396
 25.6556   24.4858   23.3794   22.3394      24.3255   25.4374  26.6729</code></pre><p>Again, it is <em>important</em> to notice that the data needs to be formatted in a matrix, with the features as rows and time steps as columns, as in this example. This is needed even if the time series consists of single values. </p><p>The construction of the ESN is also really similar. The only difference is that the reservoir can be fed as an array of reservoirs. </p><pre><code class="language-julia hljs">using ReservoirComputing

reservoirs = [RandSparseReservoir(99, radius=1.1, sparsity=0.1),
    RandSparseReservoir(100, radius=1.2, sparsity=0.1),
    RandSparseReservoir(200, radius=1.4, sparsity=0.1)]

esn = ESN(input_data;
    variation = Default(),
    reservoir = reservoirs,
    input_layer = DenseLayer(),
    reservoir_driver = RNN(),
    nla_type = NLADefault(),
    states_type = StandardStates())</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ESN{Int64, Matrix{Float64}, Default, NLADefault, Vector{Matrix{Float64}}, RNN{typeof(NNlib.tanh_fast), Float64}, Vector{Matrix{Float64}}, Vector{Matrix{Float64}}, StandardStates, Int64, Matrix{Float64}}(399, [-9.903289241214775 -9.691839850827593 … 6.13395766702855 5.3690197189757916; -9.018088588651105 -8.473011482849701 … 1.9972030630363637 1.862732065250123; 29.81517777140388 29.93605690750639 … 29.48232612752881 28.165385874059083], Default(), NLADefault(), [[-0.0022184927733871485 -0.09750042419143581 0.03382158396014853; 0.012501634177026572 -0.0809944938913638 -0.09406111488235123; … ; 0.07931047652902332 0.0022555738290855054 -0.02951198299286653; -0.026837229821435687 -0.04047662949987699 0.07396974277642707], [-0.07335538797220605 -0.026364192009685317 … -0.07923365711122099 -0.018186270878225885; -0.09042988959749675 0.05299198611649944 … 0.018033615137349274 -0.03945135558531143; … ; -0.04612500152441219 0.05992784270996926 … -0.015279803464866015 -0.018943521446068076; 0.00045947518101766005 0.07316942325674275 … -0.02453962740404622 0.020051776753595735], [-0.01952935321887457 0.004568329455035713 … 0.09345371984026576 -0.03509272952532831; 0.08205308908967349 0.07314096458704783 … 0.06177061202021622 -0.014041730867612207; … ; 0.07033039710181385 -0.027950051047230848 … -0.0778850784958871 -0.0860184419944393; -0.003000080456979165 0.08129578728205467 … -0.06706488964017931 -0.08503587760768345]], RNN{typeof(NNlib.tanh_fast), Float64}(NNlib.tanh_fast, 1.0), [[0.0 0.0 … 0.0 -0.2540854511429113; 0.0 0.0 … 0.0 -0.5158144344352219; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [0.0 0.6178766832725185 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.05512365601376944 0.0; -0.5319958395605887 0.0 … 0.0 0.0], [0.0 -0.3013568431375361 … 0.0 0.0; 0.0 0.0 … 0.08577156222247104 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]], [[0.0; 0.0; … ; 0.0; 0.0;;], [0.0; 0.0; … ; 0.0; 0.0;;], [0.0; 0.0; … ; 0.0; 0.0;;]], StandardStates(), 0, [0.9570547020294913 0.9802805700171574 … -0.43801581509384135 -0.4437295685405629; -0.9756394236010513 -0.9994378968357127 … -0.9998436741157134 -0.9998195405948263; … ; 0.0 0.0 … -0.0957650068055398 -0.08570063090999355; 0.0 0.0 … -0.41747085151057256 -0.47077182831353614])</code></pre><p>As it is possible to see, different sizes can be chosen for the different reservoirs. The input layer and bias can also be given as vectors, but of course, they have to be of the same size of the reservoirs vector. If they are not passed as a vector, the value passed will be used for all the layers in the deep ESN.</p><p>In addition to using the provided functions for the construction of the layers, the user can also choose to build their own matrix, or array of matrices, and feed that into the <code>ESN</code> in the same way.</p><p>The training and prediction follow the usual framework:</p><pre><code class="language-julia hljs">training_method = StandardRidge(0.0)
output_layer = train(esn, target_data, training_method)

output = esn(Generative(predict_len), output_layer)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3×1250 Matrix{Float64}:
  4.22483   3.83789   3.56321  …  10.0881  11.3642  12.6711  13.9101
  1.98804   2.18665   2.44875     16.7147  18.1872  19.1934  19.4035
 25.6668   24.5051   23.3982      17.9872  20.8339  24.1758  27.8655</code></pre><p>Plotting the results:</p><pre><code class="language-julia hljs">using Plots

ts = 0.0:0.02:200.0
lorenz_maxlyap = 0.9056
predict_ts = ts[shift+train_len+1:shift+train_len+predict_len]
lyap_time = (predict_ts .- predict_ts[1])*(1/lorenz_maxlyap)

p1 = plot(lyap_time, [test_data[1,:] output[1,:]], label = [&quot;actual&quot; &quot;predicted&quot;],
    ylabel = &quot;x(t)&quot;, linewidth=2.5, xticks=false, yticks = -15:15:15);
p2 = plot(lyap_time, [test_data[2,:] output[2,:]], label = [&quot;actual&quot; &quot;predicted&quot;],
    ylabel = &quot;y(t)&quot;, linewidth=2.5, xticks=false, yticks = -20:20:20);
p3 = plot(lyap_time, [test_data[3,:] output[3,:]], label = [&quot;actual&quot; &quot;predicted&quot;],
    ylabel = &quot;z(t)&quot;, linewidth=2.5, xlabel = &quot;max(λ)*t&quot;, yticks = 10:15:40);


plot(p1, p2, p3, plot_title = &quot;Lorenz System Coordinates&quot;,
    layout=(3,1), xtickfontsize = 12, ytickfontsize = 12, xguidefontsize=15, yguidefontsize=15,
    legendfontsize=12, titlefontsize=20)</code></pre><img src="7e1e6f37.svg" alt="Example block output"/><p>Note that there is a known bug at the moment with using <code>WeightedLayer</code> as the input layer with the deep ESN. We are in the process of investigating and solving it. The leak coefficient for the reservoirs has to always be the same in the current implementation. This is also something we are actively looking into expanding.</p><h2 id="Documentation"><a class="docs-heading-anchor" href="#Documentation">Documentation</a><a id="Documentation-1"></a><a class="docs-heading-anchor-permalink" href="#Documentation" title="Permalink"></a></h2><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>Gallicchio, Claudio, and Alessio Micheli. &quot;<em>Deep echo state network (deepesn): A brief survey.</em>&quot; arXiv preprint arXiv:1712.04323 (2017).</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../different_drivers/">« Using Different Reservoir Drivers</a><a class="docs-footer-nextpage" href="../hybrid/">Hybrid Echo State Networks »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.0 on <span class="colophon-date" title="Tuesday 3 October 2023 00:30">Tuesday 3 October 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
